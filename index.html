<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Filter and Remover Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen p-6">
    <div class="max-w-4xl mx-auto">
        <div class="bg-gray-800 rounded-lg shadow-2xl p-8">
            <h1 class="text-3xl font-bold mb-6 text-blue-400">Word Filter and Remover Tool</h1>
            
            <!-- Words to Remove -->
            <div class="mb-6">
                <label for="words-to-remove" class="block text-sm font-medium mb-2 text-gray-300">
                    Words to Remove (separated by spaces, commas, or newlines)
                </label>
                <textarea 
                    id="words-to-remove" 
                    rows="4" 
                    class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent outline-none text-gray-100 resize-none"
                    placeholder="Enter words to filter out..."
                ></textarea>
            </div>

            <!-- Original Text -->
            <div class="mb-6">
                <label for="original-text" class="block text-sm font-medium mb-2 text-gray-300">
                    Original Text
                </label>
                <textarea 
                    id="original-text" 
                    rows="8" 
                    class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent outline-none text-gray-100 resize-none"
                    placeholder="Paste your text here..."
                ></textarea>
            </div>

            <!-- Case Sensitive Checkbox -->
            <div class="mb-6 flex items-center">
                <input 
                    type="checkbox" 
                    id="case-sensitive" 
                    class="w-4 h-4 text-blue-600 bg-gray-700 border-gray-600 rounded focus:ring-blue-600 focus:ring-2"
                >
                <label for="case-sensitive" class="ml-2 text-sm font-medium text-gray-300">
                    Case Sensitive
                </label>
            </div>

            <!-- Process Button -->
            <button 
                id="process-button" 
                class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-200 ease-in-out focus:ring-2 focus:ring-blue-600 focus:ring-offset-2 focus:ring-offset-gray-800 mb-6"
            >
                Process & Auto-Copy Text
            </button>

            <!-- Filtered Text Output -->
            <div class="mb-4">
                <label for="filtered-text" class="block text-sm font-medium mb-2 text-gray-300">
                    Filtered Text (Auto-Copied)
                </label>
                <textarea 
                    id="filtered-text" 
                    rows="8" 
                    readonly
                    class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-gray-100 resize-none cursor-default"
                    placeholder="Filtered text will appear here..."
                ></textarea>
            </div>
        </div>
    </div>

    <!-- Notification Modal (Hidden by default) -->
    <div id="notification-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-gray-800 rounded-lg shadow-xl p-6 max-w-md w-full mx-4 border border-gray-700">
            <h3 class="text-lg font-semibold mb-3 text-red-400">Notice</h3>
            <p id="modal-message" class="text-gray-300 mb-4"></p>
            <button 
                id="modal-close" 
                class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200"
            >
                OK
            </button>
        </div>
    </div>

    <script>
        // Escape special regex characters
        function escapeRegExp(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        // Show notification modal
        function showNotification(message) {
            const modal = document.getElementById('notification-modal');
            const modalMessage = document.getElementById('modal-message');
            modalMessage.textContent = message;
            modal.classList.remove('hidden');
        }

        // Hide notification modal
        function hideNotification() {
            const modal = document.getElementById('notification-modal');
            modal.classList.add('hidden');
        }

        // Process text function
        function processText() {
            const wordsToRemoveField = document.getElementById('words-to-remove');
            const originalTextField = document.getElementById('original-text');
            const filteredTextField = document.getElementById('filtered-text');
            const caseSensitiveCheckbox = document.getElementById('case-sensitive');

            const wordsToRemoveText = wordsToRemoveField.value;
            const originalText = originalTextField.value;

            // Validation
            if (!originalText.trim()) {
                showNotification('Please paste some text to process.');
                return;
            }

            // Prepare word list: split tokens, trim, and strip surrounding brackets/quotes
            const wordsList = wordsToRemoveText
                .split(/[\s,\n]+/)
                .map(w => w.trim().replace(/^[\[\(\{\<\"']+|[\]\)\}\>\"']+$/g, ''))
                .filter(word => word !== '');

            let filteredText = originalText;

            if (wordsList.length > 0) {
                try {
                    // Escape each word and create regex pattern
                    const escapedWords = wordsList.map(word => escapeRegExp(word));
                    const wordAlternation = escapedWords.join('|');

                    // Build patterns that match either the whole word or the word wrapped in any common bracket pair
                    const bracketPatterns = [
                        `\\[\\s*(?:${wordAlternation})\\s*\\]`,
                        `\\(\\s*(?:${wordAlternation})\\s*\\)`,
                        `\\{\\s*(?:${wordAlternation})\\s*\\}`,
                        `<\\s*(?:${wordAlternation})\\s*>`
                    ].join('|');

                    const pattern = `\\b(?:${wordAlternation})\\b|${bracketPatterns}`;

                    // Determine flags based on case sensitivity
                    const flags = caseSensitiveCheckbox.checked ? 'g' : 'gi';
                    const regex = new RegExp(pattern, flags);

                    // Remove matches (this removes bracketed occurrences including their brackets)
                    filteredText = filteredText.replace(regex, '');

                    // Remove any now-empty bracket pairs repeatedly (handles nested/adjacent empty brackets)
                    let prev;
                    let iterations = 0;
                    do {
                        prev = filteredText;
                        filteredText = filteredText
                            .replace(/\[\s*\]/g, '')
                            .replace(/\(\s*\)/g, '')
                            .replace(/\{\s*\}/g, '')
                            .replace(/<\s*>/g, '')
                            .replace(/\s{2,}/g, ' ');
                        iterations++;
                    } while (filteredText !== prev && iterations < 10);
                } catch (error) {
                    showNotification('Regex error: ' + error.message);
                    return;
                }
            }

            // Post-processing cleanup
            filteredText = filteredText
                .replace(/\s{2,}/g, ' ')                    // Multiple spaces to single space
                .replace(/\s+([.,;?!\]\)\}])/g, '$1')    // Remove space before punctuation/closing brackets/braces
                .replace(/([\[\(\{\<])\s+/g, '$1')      // Remove space after opening brackets/braces
                .trim();                                    // Trim leading/trailing whitespace

            // Set filtered text
            filteredTextField.value = filteredText;

            // Auto-copy to clipboard
            filteredTextField.select();
            try {
                const successful = document.execCommand('copy');
                if (!successful) {
                    showNotification('Copy failed. Please copy manually.');
                }
            } catch (err) {
                showNotification('Copy failed: ' + err.message);
            }

            // Focus the filtered text output (user requested Enter should focus the output)
            filteredTextField.focus();
            filteredTextField.select();
        }

        // Event listeners
        document.getElementById('process-button').addEventListener('click', processText);

        // Modal close button
        document.getElementById('modal-close').addEventListener('click', hideNotification);

        // Enter key handling
        // When Enter is pressed in the words-to-remove field, focus the filtered output field.
        // Assumption: "second output field" refers to the filtered text output.
        document.getElementById('words-to-remove').addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                document.getElementById('filtered-text').focus();
                document.getElementById('filtered-text').select();
            }
        });

        document.getElementById('original-text').addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                processText();
            }
        });

        // Click outside modal to close
        document.getElementById('notification-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideNotification();
            }
        });
    </script>
</body>
</html>